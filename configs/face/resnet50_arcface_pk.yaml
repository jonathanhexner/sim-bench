# Face Recognition Training Configuration
# Dataset: CASIA-WebFace
# Model: ResNet-50 + ArcFace
# Sampler: PK Sampler (P identities x K images per batch)

# Reproducibility
seed: 42

# Device configuration
device: "cuda"  # or "cpu"

# Data configuration
data:
  data_format: "recordio"  # "recordio" or "folder"
  rec_path: "/workspace/casia-webface/train.rec"
  num_classes: 10572
  val_ratio: 0.05
  num_workers: 4

  # PK Sampler configuration
  # Batch size = P * K = 16 * 4 = 64
  sampler:
    type: "pk"  # "pk" for PK sampling, "random" for standard random
    p_identities: 16  # Number of identities per batch
    k_images: 4       # Number of images per identity

# Model configuration
model:
  backbone: "resnet50"
  pretrained: true
  embedding_dim: 512
  num_classes: 10572
  dropout: 0.0
  arcface_margin: 0.5
  arcface_scale: 64.0

# Transform configuration
transform:
  input_size: 112
  normalize_mean: [0.5, 0.5, 0.5]
  normalize_std: [0.5, 0.5, 0.5]
  augmentation:
    horizontal_flip: 0.5
    color_jitter:
      brightness: 0.1
      contrast: 0.1
      saturation: 0.1
      hue: 0.05

# Training configuration
training:
  batch_size: 64  # Used for validation; train uses P*K from sampler
  learning_rate: 0.1  # Standard for face recognition
  differential_lr: false  # Use same LR for all - simpler and often works better
  optimizer: "sgd"
  momentum: 0.9
  weight_decay: 0.0005
  max_epochs: 30
  early_stop_patience: 10

  # Learning rate schedule with warmup
  scheduler:
    type: "multistep"
    milestones: [10, 18, 24]
    gamma: 0.1
    warmup_epochs: 1  # Gradually increase LR for first epoch

# Telemetry configuration
telemetry:
  enabled: true
  collect_every_n: 100
  track_embeddings: false
  track_arcface_weights: true

# Output configuration
output_dir: null
save_embeddings: true
checkpoint_interval: 5

# Logging
log_interval: 100
